"use strict";(self.webpackChunkessentials_security=self.webpackChunkessentials_security||[]).push([[454],{5680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>y});var s=n(6540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,s,i=function(e,t){if(null==e)return{};var n,s,i={},o=Object.keys(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=s.createContext({}),c=function(e){var t=s.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return s.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},m=s.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),h=c(n),m=i,y=h["".concat(l,".").concat(m)]||h[m]||u[m]||o;return n?s.createElement(y,r(r({ref:t},p),{},{components:n})):s.createElement(y,r({ref:t},p))}));function y(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a[h]="string"==typeof e?e:i,r[1]=a;for(var c=2;c<o;c++)r[c]=n[c];return s.createElement.apply(null,r)}return s.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2795:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=n(8168),i=(n(6540),n(5680));const o={},r="HTTP Sessions",a={unversionedId:"Demystifying the Web/Hacking the Web/Reading/sessions",id:"Demystifying the Web/Hacking the Web/Reading/sessions",title:"HTTP Sessions",description:"Some websites use sessions to remember their clients across multiple requests.",source:"@site/docs/Demystifying the Web/Hacking the Web/Reading/sessions.md",sourceDirName:"Demystifying the Web/Hacking the Web/Reading",slug:"/Demystifying the Web/Hacking the Web/Reading/sessions",permalink:"/essentials-security/Demystifying the Web/Hacking the Web/Reading/sessions",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Developer Tools",permalink:"/essentials-security/Demystifying the Web/Hacking the Web/Reading/developer-tools"},next:{title:"Web Attacks",permalink:"/essentials-security/Demystifying the Web/Hacking the Web/Reading/web-attacks"}},l={},c=[{value:"Sessions in the CLI",id:"sessions-in-the-cli",level:2},{value:"Sessions in Python",id:"sessions-in-python",level:2}],p={toc:c},h="wrapper";function u(e){let{components:t,...o}=e;return(0,i.yg)(h,(0,s.A)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"http-sessions"},"HTTP Sessions"),(0,i.yg)("p",null,"Some websites use sessions to remember their clients across multiple requests.\nThese sessions are essentially IDs with which the server identifies clients.\nFor example, PHP uses a cookie called ",(0,i.yg)("inlineCode",{parentName:"p"},"PHPSESSID"),".\nIt contains a random large number."),(0,i.yg)("p",null,"Sessions are usually short-lived, which makes them ideal for storing temporary states between pages.\nSessions also expire once the user closes his browser or after a predefined amount of time (for example, 30 minutes)."),(0,i.yg)("p",null,"The basic workflow is:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"The server starts a new session (sets a cookie via the HTTP ",(0,i.yg)("inlineCode",{parentName:"li"},"Cookie")," header)."),(0,i.yg)("li",{parentName:"ol"},"The server sets a new session variable (stored on the server-side)."),(0,i.yg)("li",{parentName:"ol"},"When the client changes the page, it sends all the cookies in the request, along with the session ID from step 1."),(0,i.yg)("li",{parentName:"ol"},"The server reads the session ID from the cookie."),(0,i.yg)("li",{parentName:"ol"},"The server matches the session ID with the entries of a local list (in-memory, text file etc.)."),(0,i.yg)("li",{parentName:"ol"},"If the server finds a match, it reads the stored variables.\nFor PHP, these variables will become available in the superglobal variable ",(0,i.yg)("inlineCode",{parentName:"li"},"$_SESSION"),"."),(0,i.yg)("li",{parentName:"ol"},"If the server doesn't find a match, it will create a new session and repeat steps 1-6.")),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"Session lifecycle",src:n(6507).A,width:"602",height:"473"})),(0,i.yg)("p",null,"Example of a session in PHP (running on the server):"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"<?php\n    session_start(); // Start the session\n    $_SESSION['username'] = \"John Doe\";\n    $_SESSION['is_admin'] = true;\n    echo \"Hello \" . $_SESSION['username'];\n?>\n")),(0,i.yg)("h2",{id:"sessions-in-the-cli"},"Sessions in the CLI"),(0,i.yg)("p",null,"Guess who's back?\n",(0,i.yg)("inlineCode",{parentName:"p"},"curl"),", of course.\nWe can save the cookies sent by a server in a ",(0,i.yg)("strong",{parentName:"p"},"cookie jar"),".\nRemember this concept.\nPython uses it too.\nIt's not too sophisticated, either.\nA cookie jar is a file that contains cookies."),(0,i.yg)("p",null,"To save the cookies in a file, we use the ",(0,i.yg)("inlineCode",{parentName:"p"},"-c <file name>")," option:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"root@kali:~# curl -c cookies.txt $URL\n[...]\n\nroot@kali:~# cat cookies.txt\n# Netscape HTTP Cookie File\n# https://curl.haxx.se/docs/http-cookies.html\n# This file was generated by libcurl! Edit at your own risk.\n\nsample.domain.com FALSE / FALSE 1656864260 something nothing\n")),(0,i.yg)("p",null,"Each entry in a cookies file represents a cookie.\nIts layout is:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-plaintext"},"<domain> <include subdomains> <path> <HTTPS only> <expires at> <cookie name> <cookie value>\n")),(0,i.yg)("p",null,"We are free to modify this cookies file however we want.\nAs you can see, this file has a very specific format.\nIt's better to let ",(0,i.yg)("inlineCode",{parentName:"p"},"curl")," generate it first to make sure it's correct and only then edit it ourselves.\nThen, in order to use these cookies in a subsequent request, we use the ",(0,i.yg)("inlineCode",{parentName:"p"},"-b")," parameter:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"root@kali:~# curl -b cookies.txt $URL\n")),(0,i.yg)("p",null,"Notice it's the same parameter we used to ",(0,i.yg)("a",{parentName:"p",href:"/essentials-security/Demystifying%20the%20Web/Hacking%20the%20Web/Reading/cookies#cookies-from-the-cli"},"send cookies manually"),".\nWhen the argument is a file, ",(0,i.yg)("inlineCode",{parentName:"p"},"curl")," reads the cookies form the file.\nOtherwise, it reads them from the argument itself as strings."),(0,i.yg)("h2",{id:"sessions-in-python"},"Sessions in Python"),(0,i.yg)("p",null,"In order to send HTTP requests in Python, we can import the ",(0,i.yg)("inlineCode",{parentName:"p"},"requests")," module.\nThen, we simply create a session object which we then use to send requests.\nThis object also maintains the session cookies.\nThey are accessible via ",(0,i.yg)("inlineCode",{parentName:"p"},"session.cookies"),"."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},"s = requests.Session()\n\n# Set the value of the `something` cookie to `nothing`.\ns.cookies.set('something', 'nothing')\n\n# Send a `GET` request with the above cookie.\ns.get($URL)\n")))}u.isMDXComponent=!0},6507:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/session-4d2456ea8afc9c174b432bf9f1f4830a.jpg"}}]);